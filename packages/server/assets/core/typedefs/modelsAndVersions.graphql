extend type Project {
  model(id: String!): Model # note we're not using branch (model) names anymore
  models(limit: Int! = 20, cursor: String, query: ModelQuery): ModelCollection
  version(id: String!): Version
  # Note: exposing all versions at a stream top level could be interesting (for later)
  # versions(limit: Int! = 20, cursor: String, query: ModelQuery): ModelCollection
}

# FKA Branch
type Model {
  id: String!
  name: String!
  description: String!
  createdAt: DateTime
  # The user that created the model. (branch authorId)
  creator: LimitedUser
  # A list of the unique users that contributed versions to this model.
  authors: [LimitedUser]
  # A list of the unique source applications that contributed versions to this model.
  sourceApplications: [String!]
  # Optional: for ease of use in FE. Would replace getting versions(limit:1) and digging through it.
  # This would be used to populate the screenshot of the model card.
  latestVersion: Version
  # The list of this model's versions.
  versions(
    limit: Int! = 20
    cursor: String
    query: ModelVersionQuery
  ): VersionCollection
}

# FKA Commit
type Version {
  id: String!
  message: String
  createdAt: DateTime
  # The id of the actual object containing the data from this version.
  referencedObject: String!
  # The name of the source application that this version originated from.
  sourceApplication: String!
  # The name of the file that this version originated from. NOTE: needs schema extending!
  sourceFileName: String
  # If set by the host application connector, the id of the previous version.
  parents: [String]
  author: LimitedUser
}

type ModelCollection {
  totalCount: Int!
  cursor: String
  items: [Model!]
}

input ModelQuery {
  name: String
  # TODO: will be expanded
}

type VersionCollection {
  totalCount: Int!
  cursor: String
  items: [Version!]
}

input ModelVersionQuery {
  # text search by the version's message
  message: String
  # search by author
  authorId: String
  # search by source application
  sourceApplication: String
}

extend type Mutation {
  # Models C(R)UD
  modelCreate(model: ModelCreateInput!): String!
    @hasRole(role: "server:user")
    @hasScope(scope: "streams:write")

  modelUpdate(model: ModelUpdateInput!): Boolean!
    @hasRole(role: "server:user")
    @hasScope(scope: "streams:write")

  modelDelete(model: ModelDeleteInput!): Boolean!
    @hasRole(role: "server:user")
    @hasScope(scope: "streams:write")

  # Versions C(R)UD
  versionCreate(version: VersionCreateInput!): String!
    @hasRole(role: "server:user")
    @hasScope(scope: "streams:write")

  versionUpdate(version: VersionUpdateInput!): Boolean!
    @hasRole(role: "server:user")
    @hasScope(scope: "streams:write")

  versionReceive(input: VersionReceivedInput!): Boolean!
    @hasRole(role: "server:user")
    @hasScope(scope: "streams:read")

  versionDelete(version: VersionDeleteInput!): Boolean!
    @hasRole(role: "server:user")
    @hasScope(scope: "streams:write")

  """
  Move a batch of versions to a new branch
  """
  versionsMove(input: VersionsMoveInput!): Boolean!
    @hasRole(role: "server:user")
    @hasScope(scope: "streams:write")

  """
  Delete a batch of versions
  """
  versionsDelete(input: VersionsDeleteInput!): Boolean!
    @hasRole(role: "server:user")
    @hasScope(scope: "streams:write")
}

input ModelCreateInput {
  projectId: String!
  name: String!
  description: String
}

input ModelUpdateInput {
  projectId: String!
  id: String!
  name: String
  description: String
}

input ModelDeleteInput {
  projectId: String!
  id: String!
}

input VersionCreateInput {
  projectId: String!
  modelId: String! # Note: we're no longer using branch names -> swithcing to pure model ids.
  objectId: String!
  message: String
  sourceApplication: String
  sourceFileName: String # Note: db schema extension needed
  totalChildrenCount: Int
  parents: [String]
}

input VersionUpdateInput {
  projectId: String!
  id: String!
  message: String
  """
  To move the commit to a different model, please the id of the model.
  """
  newModelId: String
}

input VersionReceivedInput {
  projectId: String!
  versionId: String!
  sourceApplication: String!
  message: String
}

input VersionDeleteInput {
  projectId: String!
  id: String!
}

input VersionsMoveInput {
  targetModelId: String!
  versionIds: [String!]!
}

input VersionsDeleteInput {
  versionIds: [String!]!
}

# extend type Subscription {} # TODO
